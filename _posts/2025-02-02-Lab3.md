---
title: "Lab 3: Time of Flight Sensors"
date: 2025-02-11 10:15:00 -500
categories: [labs]
tags: []
math: true
---

# Prelab

> According to the datasheet, the I2C connection goes up to 400 kHz with fast mode. The I2C address is 0x52 by default, but can be set programmatically.
{: .prompt-info }

## Using Multiple ToF Sensors
Since the two ToF sensors share the same I2C address by default, they can not send data in parallel through that same address. One option would be to continuously enable/disable the two sensors, letting them send data in turns. Although simple to implement, this method has the downside of low sampling rate. Instead of that, I will change the two sensors' addresses programmatically. This is done by using the XSHUT pin to shut down one of the ToF sensors, changing its address, and then powering it on. This allows the two ToF sensors to send data through different I2C channels in parallel.

## ToF Sensor Placement
The two ToF sensor should be placed at the front of the robot, one closer to the left and the other closer to the right. Usually, the front sensors should be angled upwards (not too much relevant information on the floor), but since the robot is able to flip, postioning them directly foward offers more consistent detection overall. This postioning allows the two sensors to work together for reliable forward obstacle detection. Detection during turns would be achieved by individual sensors, depending on the direciton of the turn.


<!-- TODO: Sensors on Robot -->
<!-- TODO: Wiring Diagram -->

# Lab Tasks

## Power Artemis with Battery

![Battery](/assets/img/lab3/battery.jpeg)

{% include embed/youtube.html id='ww9znE98mRM' %}

## Install Arduino Library

![TOFLibrary](/assets/img/lab3/ToFLib.png)




## QWIIC Break-out Board to Artemis

![QWIICtoArtemis](/assets/img/lab3/QWIICtoArtemis.png)

## Single ToF to QWIIC Break-out Board

![TOFtoQWIIC](/assets/img/lab3/oneToFQWIIC.png)
![TOFtoQWIICtoArtemis](/assets/img/lab3/ToFtoQWIICtoArtemis.png)

## Scan the I2C channel

To find the address of the sensor, I used the example code for I2C. Upon running the code, the Artemis started scanning for I2C devices and found the one ToF sensor at address 0x29.

![ScanI2C](/assets/img/lab3/scanningI2C.png)

Since I2C uses the least significant bit of the address to indicate read/write, the actual address is found by bit-shifting to the left by one bit. 

> 0x29 in binary is 00101001. After the bit-shift, the result is 01010010, which is 0x52 (what we expect from the datasheet).
{: .prompt-info }


## ToF Mode

![ModeChart](/assets/img/lab3/modeChart.png)
![ModeChartSpec](/assets/img/lab3/modeChartSpec.png)

**Short Mode:**
- Pros: performance is consistent across lighting conditions 
- Cons: generally shorter range

**Medium Mode:**
- UNAVAILABLE

**Long Mode:**
- Pros: generally longer range
- Cons: performance is inconsistent across lighting conditions 

Given the pros and cons, I think short mode is better for the final robot. A longer range means nothing if the performance is inconsistent.

## Test Chosen Mode


### Accuracy
![MeasuredActual](/assets/img/lab3/measuredActual.png)

### Repeatability

### Ranging Time

## Two ToF Sensors Simultaneously

![TOFtoQWIICtoArtemis](/assets/img/lab3/2ToFtoQWIICtoArtemis.png)

## Code Execution Speed

## Sending over Bluetooth

## ToF Data vs Time

![TwoSensorsWorking](/assets/img/lab3/twoSensorsWorking.png)

## IMU Data vs Time
![Together](/assets/img/lab3/allTogether.png)
![IMUvsTime](/assets/img/lab3/IMUvsTime.png)